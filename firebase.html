<!DOCTYPE html>
<html>
    <head>
        <title>
            Firebase File Upload
        </title>

        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1"
        />
    </head>
    <body>
        <div>
            Upload Files
            <br/>
            <input type="file" id="files" multiple /><br /><br />
            <button id="send">
                Upload
            </button>
            <p id="uploading"></p>
            <progress value="0" max="100" id="progress"></progress>
        </div>
        <script>
            import { initializeApp } from "firebase/app";
            import { getAnalytics } from "firebase/analytics";
        </script>

        <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script>

        <script>
            // Firebase Configuration
            var firebaseConfig = {
            apiKey: "AIzaSyDynn0-w2p597bU6lQ-3c1F-3tn70-HQd0",
            authDomain: "invision-87460.firebaseapp.com",
            databaseURL: "https://invision-87460.appspot.com",
            projectId: "invision-87460",
            storageBucket: "invision-87460.appspot.com",
            messagingSenderId: "787564970319",
            appId: "1:787564970319:web:dd6a0e28081df14bf3453a",
            };

            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);

        </script>

        <script>
            var files = [];
            document.getElementById("files").addEventListener("change", function(e) {
                files = e.target.files;
            });
        </script>

        <script>
            document.getElementById("send").addEventListener("click", function() {
                //checks if files are selected
                if (files.length != 0) {

                    //Loops through all the selected files
                    for (let i = 0; i < files.length; i++) {

                        //create a storage reference
                        var storage = firebase.storage().ref(files[i].name);
                    
                        //upload file
                        var upload = storage.put(files[i]);
                    
                        //update progress bar
                        upload.on(
                            "state_changed",
                            function progress(snapshot) {
                                var percentage =
                                    (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                                document.getElementById("progress").value = percentage;
                            },
                    
                            function error() {
                                alert("Error Uploading File");
                            },
                    
                            function complete() {
                                document.getElementById(
                                    "Uploading"
                                ).innerHTML += `${files[i].name} Uploaded <br />`;
                            }
                        );
                    }
                } else {
                    alert("No file chosen");
                }
            });
        </script>

        <script>
            function getFileUrl(filename) {
                //create a storage reference
                var storage = firebase.storage().ref(filename);
                
                //get file url
                storage
                    .getDownloadURL()
                    .then(function(url) {
                    console.log(url);
                    })
                    .catch(function(error) {
                    console.log("Error Encountered");
                    });
            }
        </script>
    </body>
</html>